<div class="card mb-2">
  <div class="card-header">
    <h4 class="h4">Contract: {{contract.contractNumber}}</h4>
    <ul class="nav nav-tabs card-header-tabs">
      <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs.tasksDue)" [class.active]="currentTab===tabs.tasksDue">{{tabs.tasksDue}}{{contract.tasks.length ? ' ('+contract.tasks.length+')':''}}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs.tasksCompleted)" [class.active]="currentTab===tabs.tasksCompleted">{{tabs.tasksCompleted}}{{contract.completedTasks.length ? ' ('+contract.completedTasks.length+')':''}}</a>
      </li>

      <!-- <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs.completedStats); getCompletedMonthlyStats(contract.contractId)" [class.active]="currentTab===tabs.completedStats">{{tabs.completedStats}}</a>
      </li> -->

      <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs.editProgramInformation)" [class.active]="currentTab===tabs.editProgramInformation">{{tabs.editProgramInformation}}</a>
      </li>
      <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs.yourDocuments); getContractDocuments(contract.contractId)" [class.active]="currentTab===tabs.yourDocuments">{{tabs.yourDocuments}}</a>
      </li>
      <!-- Messages won't be included until after initial release. So Hide unused tab for now. -->
      <!-- <li class="nav-item">
        <a class="nav-link nav-tab-table" (click)="setCurrentTab(tabs[3])" [class.active]="currentTab===tabs[3]">Messages</a>
      </li> -->
    </ul>
  </div>
  <div class="card-body">
    <span *ngIf="currentTab===tabs.tasksDue">
      <div class="alert alert-light" *ngIf="!contract.tasks.length">
        There are no current tasks due.
      </div>
      <div *ngIf="contract.tasks.length">
        <table class="table table-sm table-striped">
          <thead class="thead">
            <th style="width:20%" scope="col">Action</th>
            <th style="width:20%" scope="col">Title</th>
            <th style="width:30%" scope="col">Description</th>
            <th style="width:15%" scope="col">Deadline</th>
          </thead>
          <tbody>
            <tr *ngFor="let task of contract.tasks">
              <td>
                <a routerLink="/authenticated/{{task.formType}}/{{task.taskId}}">
                  {{task.taskName}} <span *ngIf="!task.taskId">(missing task id)</span>
                </a>
              </td>
              <td>{{task.taskTitle}}</td>
              <td>{{task.taskDescription}}</td>
              <td>{{task.deadline|date:'yyyy-MM-dd'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </span>
    <span *ngIf="currentTab===tabs.tasksCompleted">
      <div class="alert alert-light" *ngIf="!contract.completedTasks.length">
        There are no completed tasks to show.
      </div>
      <div *ngIf="contract.completedTasks.length">
        <table class="table table-sm table-striped">
          <thead class="thead">
            <th style="width:16%" scope="col">Task</th>
            <th style="width:16%" scope="col">Title</th>
            <th style="width:16%" scope="col">Status</th>
            <th style="width:22%" scope="col">Description</th>
            <th style="width:15%" scope="col">Deadline</th>
            <th style="width:15%" scope="col">Submitted Date</th>
          </thead>
          <tbody>
            <tr *ngFor="let task of contract.completedTasks">
              <!-- || task.formType == 'status_report' -->
              <td *ngIf="task.formType == 'program_application' || task.formType == 'expense_report'  || task.formType == 'budget_proposal'">
                <a routerLink="/authenticated/{{task.formType}}/{{task.taskId}}" [queryParams]="{completed: 'true'}">
                  {{task.taskName}} <span *ngIf="!task.taskId">(missing task id)</span>
                </a>
              </td>
              <!-- && task.formType != 'status_report' -->
              <td *ngIf="task.formType != 'program_application' && task.formType != 'expense_report'  && task.formType != 'budget_proposal'">{{task.taskName}}</td>
              <td>{{task.taskTitle}}</td>
              <td>{{task.status}}</td>
              <td>{{task.taskDescription}}</td>
              <td>{{task.deadline|date:'yyyy-MM-dd'}}</td>
              <td>{{task.submittedDate|date:'yyyy-MM-dd'}}</td>
            </tr>
          </tbody>
        </table>
      </div>
    </span>

    <span *ngIf="currentTab===tabs.completedStats">
      <table class="table table-sm table-striped">
        <thead class="thead">
          <tr>
            <th scope="col">Program Name</th>
            <th scope="col">Reporting Period</th>
            <th scope="col">View Your Report</th>
            <th scope="col">Submission Date</th>
            <th scope="col">Report Status</th>
            <th scope="col">Submitted By</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loadingStats">
            <td colspan="5">Loading...</td>
            <td><i class="text-secondary spinner-border spinner-border-sm"></i></td>
          </tr>
          <tr *ngFor="let data of dataCollection; let i=index;">
            <td>{{completedStats.ProgramCollection[0].vsd_name}}</td>
            <td>{{data.reportingPeriod}}</td>
            <td>
              <ng-container>
                <!-- todo -->
                <!-- *ngIf="data.status == 'allowed to view'" -->
                <a routerLink="/authenticated/status_report/{{data.vsd_datacollectionid}}" [queryParams]="{completed: 'true'}">
                  Statistics report ({{completedStats.ProgramCollection[0].vsd_name}})
                </a>
              </ng-container>
            </td>
            <td>{{data.vsd_submissiondate | date}}</td>
            <td>get mano to add status</td>
            <td>{{completedStats.UserCollection[0].fullname}}</td>
          </tr>
        </tbody>
      </table>
    </span>

    <span *ngIf="currentTab===tabs.editProgramInformation">
      <table class="table table-sm table-striped">
        <thead class="thead">
          <tr>
            <!-- <th scope="col"></th> -->
            <th scope="col">Programs</th>
            <th scope="col">Program Contact</th>
            <th scope="col">Update Program/Contact Information</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let program of contract.programs; let i=index;">
            <!-- <th scope="row">
              {{(i|number)+1}}
            </th> -->
            <td>{{program.programName}}
            </td>
            <td>
              <strong>Name: </strong>{{program.contactName}}<br>
              <strong>Title: </strong>{{program.contactTitle}}<br>
              <strong>Email: </strong>{{program.email}}<br>
              <strong>Phone: </strong>{{program.phone | phone}}<br>
            </td>
            <td><a routerLink="/authenticated/program/{{contract.contractId}}/{{program.programId}}">Update Program/Contact Information</a></td>
          </tr>
        </tbody>
      </table>
    </span>
    <span *ngIf="currentTab===tabs.yourDocuments">
      <div class="upload-documents-container">
        <a routerLink="/authenticated/upload_document/{{contract.contractId}}" class="btn btn-primary">Upload Contract Documents</a>
      </div>
      <table class="table table-sm table-striped">
        <thead class="thead">
          <tr>
            <th scope="col">Your Document</th>
            <th scope="col">Available Date</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngIf="loadingDocuments">
            <td>Loading...</td>
            <td><i class="text-secondary spinner-border spinner-border-sm"></i></td>
          </tr>
          <tr *ngFor="let doc of documentCollection; let i=index;">
            <td><span class="download-link" (click)="downloadDocument(doc)">{{doc.filename}}</span></td>
            <td>
              {{doc.overwritetime | date:'yyyy-MM-dd'}}
            </td>
          </tr>
        </tbody>
      </table>
    </span>

    <span *ngIf="currentTab===tabs.messages">
      <table class="table table-sm table-striped">
        <thead class="thead">
          <tr>
            <th scope="col">Timestamp</th>
            <th scope="col">Messages</th>
            <th scope="col">Program</th>
            <th scope="col">Location</th>
          </tr>
        </thead>
        <tbody>

        </tbody>
      </table>
    </span>
  </div>
</div>